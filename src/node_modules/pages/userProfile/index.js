import React, {Fragment, useEffect, useContext, useState} from 'react'
import useFetch from 'hooks/useFetch'
import FeedItemUser from 'components/feeditemuser'
import PostToggle from 'components/Posttoggle'

const UserProfile = (props) => {
    const [username, setUsername] = useState('')
    const [bio, setBio] = useState('')
    const [image, setImage] = useState('')
    const [following, setFollowing] = useState('')
    const slug = props.match.params.slug
    const apiUrl = `/profiles/${slug}`
    const [{error, response, isLoading}, doFetch] = useFetch(apiUrl)

    useEffect(() => {
        doFetch()
    }, [doFetch])

    useEffect(() => {
        if(!response) {
            return false
        }
        const {profile} = response;
        setUsername(profile.username)
        setBio(profile.bio)
        setFollowing(profile.following)
        setImage(profile.image)
    }, [response])
    return (
        <Fragment>
        <div className="page-header">
            <div className="page-content">
             { response &&  (<div className="profile-header">
                     <img src={image} alt="image"/>
                     <span>
                         {username}
                     </span>
                     <p>{bio}</p>
                </div>)}
            </div>
        </div>
        <PostToggle slug={slug} />
        </Fragment>
    )
}

export default UserProfile

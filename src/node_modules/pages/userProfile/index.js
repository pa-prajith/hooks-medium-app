import React, {Fragment, useEffect, useState} from 'react'
import useFetch from 'hooks/useFetch'
import Userprofilelist from 'components/userprofilelist'

const UserProfile = ({location, match}) => {
    const [username, setUsername] = useState('')
    const [bio, setBio] = useState('')
    const [image, setImage] = useState('')
    const [following, setFollowing] = useState('')
    const slug = match.params.slug
    const apiUrl = `/profiles/${slug}`
    const [{error: errorUser, response: responseUser, isLoading: isLoadingUser}, doFetchUser] = useFetch(apiUrl)

    useEffect(() => {
        doFetchUser()
    }, [doFetchUser])

    useEffect(() => {
        if(!responseUser) {
            return false
        }
        const {profile} = responseUser;
        setUsername(profile.username)
        setBio(profile.bio)
        setFollowing(profile.following)
        setImage(profile.image)
    }, [responseUser])

    return (
        <Fragment>
            <div className="page-header">
                <div className="page-content">
                { responseUser &&  (<div className="profile-header">
                                        <img src={image} alt="image"/>
                                        <span>
                                            {username}
                                        </span>
                                        <p>{bio}</p>
                                    </div>)}
                </div>
       </div> 
      { responseUser &&  ( <Userprofilelist location={location} match={match} username={username} />)}
        </Fragment>
    )
}

export default UserProfile
